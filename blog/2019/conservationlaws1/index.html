<!DOCTYPE html>
<!-- _layouts/distill.html --><html>
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Numerical methods for conservation laws (part 1) | Justin  Dong</title>
    <meta name="author" content="Justin  Dong">
    <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design.
">
    <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website">


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous">

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700%7CRoboto+Slab:100,300,400,500,700%7CMaterial+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light">

    <!-- Styles -->
    
    <link rel="shortcut icon" href="/assets/img/icon.png">
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="http://localhost:4000/blog/2019/conservationlaws1/">
    
    <!-- Dark Mode -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark">

    <script src="/assets/js/theme.js"></script>
    <script src="/assets/js/dark_mode.js"></script>
    


    <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams'
      }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    <!-- Distill js -->
    <script src="/assets/js/distillpub/template.v2.js"></script>
    <script src="/assets/js/distillpub/transforms.v2.js"></script>
    <script src="/assets/js/distillpub/overrides.js"></script>
    
  </head>

  <head>
        <style>      
      d-article d-contents {
        align-self: start;
        grid-column: 1 / 4;
        grid-row: auto / span 3;
        width: max(70%, 300px);      
        margin-right: 0px;
        margin-top:  0em;
        display: grid;      
        grid-template-columns: 
          minmax(8px, 1fr) [toc] auto 
          minmax(8px, 1fr) [toc-line] 1px
          minmax(32px, 2fr );      
      }
      d-article d-contents nav {      
        grid-column: toc;
      }
      d-article d-contents .figcaption {
        line-height: 1.4em;
      }
      d-article d-contents .toc-line {
        border-right: 1px solid rgba(0, 0, 0, 0.1);
        grid-column: toc-line;
      } 
  
      b i {
        display: inline;
      }
  
      d-article d-contents {      
        align-self: start;
        grid-column: 1 / 4;
        grid-row: auto / span 4;
        justify-self: end;
        margin-top: 0em;
        padding-right: 3em;
        padding-left: 2em;
        border-right: 1px solid rgba(0, 0, 0, 0.1);
      }
  
      d-contents nav h3 {
        margin-top: 0;
        margin-bottom: 1em;
      }
  
      d-contents nav div {
        color: rgba(0, 0, 0, 0.8);
        font-weight: bold;
      }
  
      d-contents nav a {
        color: rgba(0, 0, 0, 0.8);
        border-bottom: none;
        text-decoration: none;
      }
  
      d-contents ul {
        padding-left: 1em;
      }
  
      d-contents nav ul li {
        margin-bottom: 0.25em;
      }
  
      d-contents nav a:hover {
        text-decoration: underline solid rgba(0, 0, 0, 0.6);
      }
  
      d-contents nav ul {
        margin-top: 0;
        margin-bottom: 6px;
      }
  
      d-contents nav > div {
        display: block;
        outline: none;
        margin-bottom: 0.8em;
      }
  
      d-contents nav > div > a {
        font-size: 13px;
        font-weight: 600;
      }
  
      
      d-contents nav > ul > li > a:hover {
        text-decoration: none;
      }

      
    @media (max-width: 1300px) {
      d-article d-contents {      
        justify-self: start;
        align-self: start;        
        grid-column-start: 3;
        grid-column-end: -3;
        padding-bottom: 0.5em;
        margin-bottom: 1em;
        padding-top: 0.5em;            
        width: 100%;
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        border-left: 1px solid rgba(0, 0, 0, 0.1);
        border-top: 1px solid rgba(0, 0, 0, 0.1);
        border-bottom-width: 1px;
        border-bottom-style: solid;
        border-bottom-color: rgba(0, 0, 0, 0.1);          
      }
    }
    </style>
  </head>

  <body>
<d-front-matter>
    <script async type="text/json">{
      "title": "Numerical methods for conservation laws (part 1)",
      "description": "",
      "published": "May 15, 2019",
      "authors": [
        {
          "author": "Justin Dong",
          "authorURL": "",
          "affiliations": [
            {
              "name": "Division of Applied Math, Brown University",
              "url": ""
            }
          ]
        }
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script>
  </d-front-matter>

  

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">JustinÂ </span>Dong</a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">about</a>
              </li>
              
              <!-- Blog -->
              <li class="nav-item active">
                <a class="nav-link" href="/blog/">notes<span class="sr-only">(current)</span></a>
              </li>

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/publications/">publications</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/cv/">cv</a>
              </li>

              <!-- Toogle theme mode -->
              <li class="toggle-container">
                <button id="light-toggle" title="Change theme">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- Scrolling Progress Bar -->
      <progress id="progress" value="0">
        <div class="progress-container">
          <span class="progress-bar"></span>
        </div>
      </progress>
    </header>


    <!-- Content -->
    <div class="post distill">

      <d-title>
        <h1>Numerical methods for conservation laws (part 1)</h1>
        <p></p>
      </d-title>

      <d-byline></d-byline>

      <d-article>
        <d-contents>
          <nav class="l-text figcaption">
          <h3>Contents</h3>
            <div><a href="#1-conservation-laws">1. Conservation Laws</a></div>
            <ul>
              <li><a href="#i-weak-solutions-of-conservation-laws">I. Weak Solutions of Conservation Laws</a></li>
              <li><a href="#ii-entropy-solutions-of-conservation-laws">II. Entropy Solutions of Conservation Laws</a></li>
              
            </ul>
<div><a href="#2-monotone-schemes">2. Monotone Schemes</a></div>
            <ul>
              <li><a href="#i-the-finite-volume-method">I. The Finite Volume Method</a></li>
              <li><a href="#ii-implementation">II. Implementation</a></li>
              
            </ul>
<div><a href="#3-key-takeaways">3. Key Takeaways</a></div>
            <div><a href="#4-references">4. References</a></div>
            <div><a href="#5-codes">5. Codes</a></div>
            
          </nav>
        </d-contents>

        <h1 id="1-conservation-laws"><strong>1. Conservation Laws</strong></h1>

<p>In this post, weâll take a look at conservation laws, the contexts in which they arise in nature, and some of the numerical methods used for solving them. In one spatial-dimension, conservation laws take the general form</p>

\[\begin{equation}
  \begin{cases}
    u_{t} + f(u)_{x} = 0 &amp;\text{in}\;\mathbb{R} \times [0,\infty)\\
    u(x,0) = u_{0}(x) &amp;\text{on}\;\mathbb{R} \times \{t=0\}.
  \end{cases}
  \label{eq:conslaw}
\end{equation}\]

<p>Here, we consider the spatial domain to be the entire real line (thus, we have no boundary conditions). The function \(f(u)\) â typically called the <em>flux function</em> â is sufficiently smooth. As their name suggests, conservation laws preserve mass. We often think of the quantity \(u\) as the density of some fluid, in which case \(\int_{\mathbb{R}} u(x,t)dx\) may be viewed as the mass of fluid. If we assume that \(u\) is compactly supported in \(x\) (i.e. it is zero outside of some compact set in \(x\), a reasonable assumption as the fluid should have finite mass) and \(f(0) = 0\), then taking derivatives over time yields</p>

\[\begin{align}
  \frac{\partial}{\partial t} \int_{-\infty}^{\infty} u(x,t)\;dx &amp;= \int_{-\infty}^{\infty} \frac{\partial u}{\partial t}\;dx = -\int_{-\infty}^{\infty} \frac{\partial f(u)}{\partial x}\;dx\notag\\
  &amp;= f(u(-\infty)) - f(u(\infty)) = 0.\notag
\end{align}\]

<p>The above computation implies that \(\int_{\mathbb{R}} u(x,t)\;dx = \int_{\mathbb{R}} u(x,0)\;dx\): the mass of \(u\) is conserved over time.</p>

<p>To gain some intuition for how solutions of this PDE might behave, weâll first consider the simplest conservation law there is: the linear advection equation. Taking \(f(u) = u\), it is evident that our solution is given by \(u(x,t) = u_{0}(x-t)\). The PDE âtransportsâ the initial profile in the \(x\) direction. In particular, we note that the solution to the <em>linear</em> conservation law is exactly as smooth as our initial data. That is, if \(u_{0} \in C^{1}_{x}(\mathbb{R})\) then \(u \in C_{x}^{1}(\mathbb{R})\) as well. We havenât said anything particularly illuminating thus far and indeed, the linear advection equation isnât particularly interesting to begin with.</p>

<p>Next, letâs consider a simple nonlinear conservation law:</p>

\[\begin{align}
\begin{cases}
  u_{t} + uu_{x} = 0 &amp;\text{in}\;\mathbb{R} \times [0,\infty)\\
  u(x,0) = \sin{x} &amp;\text{on}\;\mathbb{R} \times \{t=0\}.
\end{cases}
\end{align}\]

<p>The initial condition is as smooth as possible now: \(\sin{x} \in C_{x}^{\infty}(\mathbb{R})\). But what can we say about \(u(x,t)\)? Should we still expect it to be smooth in \(x\)? It turns out that the answer is a resounding <em>no</em>. In fact, solutions to the above nonlinear PDE (known as <em>Burgers equation</em>) are not even \(C_{x}^{0}(\mathbb{R})\)! The exact mathematical cause of this phenomena is due to the crossing of something called characteristic curves, but we will first consider a more intuitive explanation.</p>

<p>We may view Burgers equation as an advection equation in which the speed of propagation is equal to \(u\) itself. Our initial sine profile thus moves with variable speed in \(x\). For \(0 \leqslant x \leqslant \pi\), the sine wave is positive and the solution travels forward. For \(\pi &lt; x \leqslant 2\pi\), the sine wave is negative and the solution travels backwards. The animation below shows how the solution of Burgers equation evolves over time, and we see the development of a genuine discontinuity at \(x=\pi\).</p>

<div class="container">
  <div class="row">
    <div class="col">
    </div>
    <div class="col-10">
      <figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/conslaw1/burgers.gif-480.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/conslaw1/burgers.gif-800.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/conslaw1/burgers.gif-1400.webp"></source>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/conslaw1/burgers.gif" class="img rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">

  </picture>

</figure>

      <div class="caption">
        <b>Figure 1:</b> Solution of Burgers equation with sine initial data.
      </div> 
    </div>
    <div class="col">
    </div>
  </div>
</div>

<p>Shocks such as the one above occur naturally in many settings, for instance high-speed compressible flows and aeroacoustics. However, a natural question we might ask next is how discontinuities and shocks fit with our notion of the classical solution of a PDE. For instance, the linear advection equation contains a first-order time derivative and a first-order spatial derivative. Naturally, we should require that \(u \in C_{x,t}^{1}(\mathbb{R} \times [0,\infty))\) â our solution should be once differentiable in space and time. Consider, though, the linear advection equation with \(u(x,0) = ð_{\\{x \leqslant 0\\}}\). Youâll probably agree with me that the only possible solution to this problem is \(u(x,t) = ð_{\\{x \leqslant t\\}}\), and yet this âsolutionâ is not even continuous let alone differentiable. Before moving on to numerical solvers, we will spend some time developing alternative notions of PDE solutions that are capable of admitting discontinuities and shocks.</p>

<h2 id="i-weak-solutions-of-conservation-laws">I. Weak Solutions of Conservation Laws</h2>
<p><strong>Definition 1.</strong> <em>We call \(u(x,t)\) a</em> <strong>weak solution</strong> <em>of the conservation law \eqref{eq:conslaw} if</em></p>

\[\begin{equation} 
  \int_{0}^{\infty}\int_{-\infty}^{\infty} u\varphi_{t} + f(u)\varphi_{x}\;dxdt = -\int_{-\infty}^{\infty} u(x,0)\varphi(x,0)\;dx
  \label{eq:weaksol}
\end{equation}\]

<p><em>for all \(\varphi \in C_{c}^{\infty}(\mathbb{R} \times \mathbb{R})\).</em></p>

<p>We refer to \(\varphi\) as a test function. It is smooth in both space and time and compactly supported, i.e. \(\varphi\) is zero outside of some compact set in space and time. Letâs break down whatâs actually going on in the definition of the weak solution. The most notable feature is that if $u$ is a weak solution, it does <em>not</em> have to be differentiable in space or time since the definition only contains derivatives of \(\varphi\)!</p>

<p>So how do we arrive at this definition? First, we multiply the entire conservation law by \(\varphi\):
\begin{align}
  u_{t}\varphi + f(u)_{x}\varphi = 0.\notag
\end{align}</p>

<p>Then, we integrate in time over $[0,\infty)$ and in space over the entire real line:
\begin{align}
  \int_{0}^{\infty}\int_{-\infty}^{\infty} u_{t}\varphi + f(u)_{x}\varphi\;dxdt = 0.\notag
\end{align}</p>

<p>The last step is to integrate the first term by parts in time and the second term by parts in space:</p>

\[\begin{align}
  \int_{0}^{\infty} \int_{-\infty}^{\infty} u_{t}\varphi dxdt &amp;= -\int_{0}^{\infty} \int_{-\infty}^{\infty} u\varphi_{t}dxdt + \int_{-\infty}^{\infty} u(x,0)\varphi(x,0)dx\notag\\
  \int_{0}^{\infty} \int_{-\infty}^{\infty} f(u)_{x}\varphi\;dxdt &amp;= -\int_{0}^{\infty} \int_{-\infty}^{\infty} f(u)\varphi_{x}\;dxdt
\end{align}\]

<p>Most of the boundary terms vanish because \(\varphi\) has compact support: we have \(\varphi(\pm \infty,t) = \varphi(x,\pm\infty) = 0\). Note that in integrating by parts, we pass the derivatives from \(u\) onto the test function. Altogether, we obtain
\begin{align}
\int_{0}^{\infty}\int_{-\infty}^{\infty} u\varphi_{t} + f(u)\varphi_{x}\;dxdt = -\int_{-\infty}^{\infty} u(x,0)\varphi(x,0)\;dx.\notag
\end{align}</p>

<p>But <em>why</em> do we do this? The idea is that rather than consider pointwise values of \(u(x,t)\), we consider averaged values of \(u(x,t)\) against test functions. If youâve taken a functional analysis course, you can view the integration against a test function as the evaluation of a distribution induced by \(u_{t}\) and \(f(u)_{x}\). We note that all classical solutions (\(C_{x,t}^{1}\) solutions that satisfy the PDE in a pointwise sense) are weak solutions but the converse is certainly not true.</p>

<p>It is straightforward to verify that \(ð_{\\{x\leqslant t\\}}\) is a weak solution of the linear advection equation with \(u(x,0) = ð_{\\{x \leqslant 0\\}}\). However, the definition $\eqref{eq:weaksol}$ of quite cumbersome to work with and we would like to develop a more convenient way to verify whether we have a weak solution or not. Notice that \(u(x,t) = ð_{\\{x\leqslant t\\}}\) as well as the solution of Burgers equation in Figure 1 are piecewise smooth and only discontinuous at a single point that may (in the case of linear advection) or may not (in the case of Burgers equation) change with time. In this case, we can say much more about the structure of the weak solution.</p>

<p><strong>Theorem 1. (Rankine-Hugoniot)</strong> <em>Suppose the solution of \eqref{eq:conslaw} is piecewise smooth and contains a discontinuity along the curve \(x(t)\). Then \(u\) is a weak solution of \eqref{eq:conslaw} if and only if</em>
\begin{equation}
  xâ(t) = \frac{f(u^{-}) - f(u^{+})}{u^{-} - u^{+}},
  \label{eq:RH}
\end{equation}</p>

<p><em>where \(x'(t)\) is the speed of the discontinuity and \(u^{\pm}\) are the values of \(u\) along each side of the shock.</em></p>

<p>Condition \eqref{eq:RH} is referred to as the <strong>Rankine-Hugoniot jump condition</strong>.</p>

<p><strong>Example 1.</strong> <em>Letâs return to the linear advection equation and use the jump condition to verify that \(ð_{\\{x\leqslant t\\}}\) is a weak solution. We have \(x'(t) = 1\), \(u^{-} = 1\), and \(u^{+} = 0\). Then</em>
\begin{align}
  \frac{f(u^{-}) - f(u^{+})}{u^{-} - u^{+}} = \frac{u^{-} - u^{+}}{u^{-} - u^{+}} = 1\notag
\end{align}
<em>and the jump condition is satisfied.</em></p>

<p>Thus, the Rankine-Hugoniot condition is a handy way for us to verify whether something is a weak solution. It turns out that solutions to conservation laws often have the structure required by Theorem 1 â that is, they are piecewise smooth except along finitely many curves of discontinuity.</p>

<p>By relaxing the definition of the solution, we are able to admit much less smooth solutions to \eqref{eq:conslaw}. However, we will see weak solutions need not be unique! Consider Burgers equation with the initial condition \(u(x,0) = -ð_{\\{x\leqslant 0\\}} + ð_{\\{x&gt;0\\}}\). It is straightforward to verify that \(u(x,t) = -ð_{\\{x\leqslant 0\\}} + ð_{\\{x&gt;0\\}}\) as well as</p>

\[\begin{align}
u(x,t) = \begin{cases}
  -1 &amp;x \leqslant -t\\
  \frac{x}{t} &amp;-t &lt; x \leqslant t\\
  1 &amp;x &gt; t
  \end{cases}
\end{align}\]

<p>are both weak solutions. The first weak solution does not change at all with time, so our intuition might tell us that this solution does not make much physical sense. But what about the second weak solution? At the very least, we need to establish more stringent criteria for our weak solutions in order to pick out the physically relevant solution.</p>

<h2 id="ii-entropy-solutions-of-conservation-laws">II. Entropy Solutions of Conservation Laws</h2>

<p>Consider the slightly modified PDE given by</p>

\[\begin{equation}
  \begin{cases}
    u^{(\varepsilon)}_{t} + f(u^{(\varepsilon)})_{x} = \varepsilon u^{(\varepsilon)}_{xx} &amp;\text{in}\;\mathbb{R} \times (0,\infty)\\
    u^{(\varepsilon)}(x,0) = u_{0}(x) &amp;\text{on}\;\mathbb{R} \times \{t=0\}.
    \label{eq:viscosityPDE}
  \end{cases}
\end{equation}\]

<p>This PDE is <em>parabolic</em> and it turns out that the solution \(u^{(\varepsilon)}\), if it exists, is smooth and unique.</p>

<p><strong>Definition 2.</strong> <em>The entropy solution of \eqref{eq:conslaw} is defined as</em>
\begin{align}
u(x,t) = \lim_{\varepsilon \to 0} u^{(\varepsilon)}(x,t).\notag
\end{align}
<em>This limit, if it exists, is unique and is a weak solution of  \eqref{eq:conslaw}.</em></p>

<p>Again, this definition is quite difficult to work with, even moreso than the original definition of the weak solution, and we need to establish a more efficient way of verifying whether we have the entropy solution or not. There are alternative definitions based on the notions of <em>entropy flux</em> and <em>entropy flux functions</em>, but weâll skip right to the chase here. Thanks to the work of Oleinik and Lax, we have a quick way to identify entropy solutions.</p>

<p><strong>Theorem 2. (Oleinik Entropy Condition)</strong> <em>Suppose the solution of \eqref{eq:conslaw} is piecewise smooth and contains a discontinuity along the curve \(x(t)\). Then \(u\) is the entropy solution if and only if</em>
\begin{equation}
  \frac{f(u) - f(u^{-})}{u - u^{-}} \geqslant \frac{f(u^{+}) - f(u^{-})}{u^{+} - u^{-}} \geqslant \frac{f(u^{+}) - f(u)}{u^{+} - u}
  \label{eq:oleinik}
\end{equation}
for all \(u\) between \(u^{-}\) and \(u^{+}\).*</p>

<p>Again, \(u^{-}\) and \(u^{+}\) denote the values of $u$ on each side of the shock \(x(t)\). However, we can simplify \eqref{eq:oleinik} even further if we have a <em>convex</em> conservation law, which is simply the case when \(f(u)\) is convex. For Burgers equation, we have \(f(u) = u^{2}/2\), which is indeed convex. The Lax Entropy condition tells us the following.</p>

<p><strong>Theorem 3. (Lax Entropy Condition)</strong> <em>Suppose the solution of \eqref{eq:conslaw} is piecewise smooth and contains a discontinuity along the curve \(x(t)\). Suppose also that \(f\) is convex. Then \(u\) is the entropy solution if and only if
\begin{equation}
  fâ(u^{-}) \geqslant \frac{f(u^{+}) - f(u^{-})}{u^{+} - u^{-}} \geqslant fâ(u^{+}).
  \label{eq:lax}
\end{equation}
In particular, \eqref{eq:lax} is equivalent to requiring that \(u^{-} &gt; u^{+}\).</em></p>

<p>The Lax Entropy condition tells us that for convex conservation laws, the value of the weak solution on the left side of the shock ($u^{-}$) must be larger than the value of the solution on the right side of the shock ($u^{+}$) in order for the weak solution to be an entropy solution. The physical intuition behind the entropy solution is related to the entropy of a fluid in gas dynamics: in smooth flows, the entropy remains constant along particle paths, and if the particle crosses a shock, the entropy may only jump to a <em>higher</em> value. Entropy is inversely proportional to density, and so the density $u$ can only jump to lower values along a shock.</p>

<p>Weâve spent a lot of time now developing the main ideas of weak solutions for conservation laws. We can concretely define what it means to have discontinuous solutions of \eqref{eq:conslaw} and impose conditions to guarantee the uniqueness of this solution. Great. We can finally move on to numerical methods for solving conservation laws. In developing such schemes, our goal will be to ensure that our scheme converges (in some sense) to the entropy solution.</p>

<h1 id="2-monotone-schemes"><strong>2. Monotone Schemes</strong></h1>
<p>First, a cautionary tale in constructing numerical methods for conservation laws. We consider Burgers equation with the initial condition \(u(x,0) = ð_{\\{x \geqslant 0\\}}\) and the following finite difference scheme:
\begin{align}
  u_{j}^{n+1} = u_{j}^{n} - \frac{\Delta t}{\Delta x} u_{j}^{n}(u_{j}^{n} - u_{j-1}^{n}).\notag
\end{align}</p>

<p>Initially, we have \(u_{j}^{0} = ð_{\\{x_{j} \geqslant 0\\}}\). However, this scheme returns \(u_{j}^{n} = u_{j}^{0}\) for all \(n\) and $j$, so the scheme converges to \(u(x,t) = u(x,0)\). But in the preceding sections, we established that this canât even be a weak solution (indeed, the Rankine-Hugoniot condition is not satisfied).</p>

<p>Clearly, we must exercise caution in constructing schemes to solve \eqref{eq:conslaw}. We have just seen that a perfectly reasonable-looking finite difference scheme (at least, at first glance) fails to converge to a weak solution, let alone the correct entropy solution. In other cases, it may be possible that a scheme converges to a weak solution but not an entropy solution. We will circle back to this idea shortly.</p>

<h2 id="i-the-finite-volume-method">I. The Finite Volume Method</h2>
<p>We begin by introducing the <strong>finite volume method</strong>, which discretizes the spatial domain into cells (intervals in 1D, rectangles or other polygons in 2D), and computes an approximation to the average of the solution in each cell. The precise formulation is as follows: consider a bounded, open, connected domain \(\Omega = (a,b) \subset \mathbb{R}\) and a finite stopping time \(T\), and consider the conservation law given by
\(\begin{equation}
  \begin{cases}
    u_{t} + f(u)_{x} = 0 &amp;\text{in}\;\Omega \times (0,T)\\
    u(x,0) = u_{0}(x) &amp;\text{on}\;\Omega \times \{t=0\}.
  \end{cases}
  \label{eq:conslaw2}
\end{equation}\)</p>

<p>We discretize \(\Omega\) into equally-sized cells \(I_{j} = (x_{j-1/ 2}, x_{j+1/ 2})\):
\begin{align}
  a = x_{1/ 2} &lt; x_{3/ 2} &lt; \dots &lt; x_{N+1/ 2} = b, \;\;\;\Delta x := x_{j+1/ 2} - x_{j-1/ 2}.\notag
\end{align}</p>

<p>Next, we integrate \eqref{eq:conslaw2} over each cell \(I_{j}\):</p>

\[\begin{align}
  \int_{x_{j-1/ 2}}^{x_{j+1/ 2}} (u_{t} + f(u)_{x})\;dx &amp;= 0\notag\\
  \Delta x \frac{d\bar{u}_{j}}{dt} + f(u_{j+1/ 2}^{-}) - f(u_{j-1/ 2}^{+}) &amp;= 0\notag\\
  \frac{d\bar{u}_{j}}{dt} + \frac{f(u_{j+1/ 2}) - f(u_{j-1/ 2})}{\Delta x} &amp;= 0\notag
\end{align}\]

<p>Here, \(\bar{u}_{j}\) denotes the cell average of \(u\) in cell \(I_{j}\): \(\bar{u}_{j} := \frac{1}{\Delta x}\int_{I_{j}} u\;dx\). If our goal is to solve for the cell averages \(\bar{u}_{j}\), you might notice that the second term poses a problem as it is formulated in terms of pointwise values of \(u\) at \(x_{j-1/ 2}\) and \(x_{j+1/ 2}\) rather than \(\bar{u}_{j}\). In the first finite volume scheme we consider, we will approximate \(u\) in \(I_{j} = (x_{j-1/ 2}, x_{j+1/ 2})\) by the cell average \(\bar{u}_{j}\) in \(I_{j}\).</p>

<p>This approximation is not so well defined as the points \(x_{j+1/ 2}\), which lie at the intersection between the two cells \(I_{j}\) and \(I_{j+1}\). The finite volume scheme remedies this by introducing a <em>numerical flux function</em> which takes as inputs cell averages and returns an approximation of the flux function at the cell endpoints \(x_{j+1/ 2}\), i.e. \(f(u_{j+1/ 2}) \approx \hat{f}(\bar{u}_{j}, \bar{u}_{j+1})\) and \(f(u_{j-1/ 2}) \approx \hat{f}(\bar{u}_{j-1}, \bar{u}_{j})\):</p>

\[\begin{equation}
  \frac{d\bar{u}_{j}}{dt} + \frac{1}{\Delta x}\left(\hat{f}(\bar{u}_{j}, \bar{u}_{j+1}) - \hat{f}(\bar{u}_{j-1}, \bar{u}_{j})\right) = 0.
  \label{eq:finitevol}
\end{equation}\]

<p>Thus, \(\hat{f}\) can be viewed in this context as a function which takes in the dual values at the cell interfaces and returns a single, physically relevant value. This will be important when we try to develop higher order finite volume schemes later.</p>

<p>For now, the only thing left to do to turn \eqref{eq:finitevol} into a usable scheme is to discretize the time derivative. The simplest option is to use a first-order finite difference. In doing so, we arrive at the explicit first-order finite volume scheme.</p>

<p><strong>Definition 3.</strong> <em>The explicit first-order finite volume scheme in space and time is given by</em>
\(\begin{equation}
  \bar{u}_{j}^{n+1} = \bar{u}_{j}^{n} - \frac{\Delta t}{\Delta x}\left( \hat{f}(\bar{u}_{j}^{n}, \bar{u}_{j+1}^{n}) - \hat{f}(\bar{u}_{j-1}^{n}, \bar{u}_{j}^{n}) \right),
  \label{eq:finitevol2}
\end{equation}\)</p>

<p><em>where \(\bar{u}_{j}^{n}\) denotes the cell averages at time \(t^{n}\) and \(\bar{u}_{j}^{n+1}\) the cell averages at time \(t^{n+1} = t^{n} + \Delta t\).</em></p>

<p>Notice that we havenât specified what, exactly, the flux function \(\hat{f}\) is yet. The choice of \(\hat{f}\) is immensely important as it will determine many properties of our scheme, such as convergence to the entropy solution. Before stating some possible choices of \(\hat{f}\), we will first cover the properties \(\hat{f}\) must satisfy in order to converge to the entropy solution.</p>

<p><strong>Definition 4.</strong> <em>A</em> <strong>monotone scheme</strong> <em>is one that can be written in the form</em>
\(\begin{equation}
  \bar{u}_{j}^{n+1} = \mathcal{H}(\bar{u}_{j-p}^{n}, \dots, \bar{u}_{j+q}^{n}),
\end{equation}\)</p>

<p><em>where \(\mathcal{H}\) is a nondecreasing function in all arguments. In particular, the monotone scheme on the three-point stencil \(\{\bar{u}_{j-1}^{n}, \bar{u}_{j}^{n}, \bar{u}_{j+1}^{n}\}\) is given by \(\bar{u}_{j}^{n+1} = \mathcal{H}(\bar{u}_{j-1}^{n}, \bar{u}_{j}^{n}, \bar{u}_{j+1}^{n})\).</em></p>

<p>This is all well and good, but why should we care about monotone schemes? To begin with, they have a number of remarkable properties that guarantee our numerical solution behaves ânicely.â</p>

<p><strong>Theorem 4.</strong> <em>Monotone schemes satisfy the following properties:</em></p>

<ol>
  <li>
    <p><strong>Local maximum principle.</strong>
\(\begin{align}
  \min_{j-p \leqslant i \leqslant j+q} \bar{u}_{i}^{n} \leqslant \mathcal{H}(\bar{u})_{j} \leqslant \max_{j-p \leqslant i \leqslant j+q} \bar{u}_{i}^{n} \;\;\;\forall j.\notag
\end{align}\)</p>
  </li>
  <li>
    <p><strong>Total variation diminishing property.</strong>
\(\begin{align}
  ||\mathcal{H}(\bar{u})||_{BV} \leqslant ||\bar{u}||_{BV},\notag
\end{align}\)
<em>where the bounded variation seminorm is given by \(||u||_{BV} = \sum_{j} |u_{j} - u_{j-1}|\).</em></p>
  </li>
  <li>
    <p><strong>Entropy solution.</strong> <em>Monotone schemes converge to the entropy solution with a rate in \(\ell^{1}\) of half-order. This bound is sharp.</em></p>
  </li>
</ol>

<p>Roughly speaking, the local maximum principle tells us that our cell averages at \(t^{n+1}\) cannot be larger or smaller than our averages at \(t^{n}\) around the stencil \(\{\bar{u}_{j-p}^{n}, \dots, \bar{u}_{j+q}^{n}\}\). The total variation diminishing property tells us that our cell averages can only decrease in bounded variation. In particular, this means that our cell averages at \(t^{n+1}\) cannot be more oscillatory than our cell averages at \(t^{n}\). We will see soon some schemes which violate this property and tend to produce spurious oscillations in the numerical solution. The last property is of course self-explanatory: by using a monotone scheme, we are guaranteed to converge to the entropy solution!</p>

<p>We would like for the finite volume scheme in \eqref{eq:finitevol2} to be a monotone scheme, and our goal now is to choose a function \(\hat{f}\) in order to achieve this. We have</p>

\[\begin{align}
  \mathcal{H}(\bar{u}_{j-1}^{n}, \bar{u}_{j}^{n}, \bar{u}_{j+1}^{n}) = \bar{u}_{j}^{n} - \frac{\Delta t}{\Delta x}\left( \hat{f}(\bar{u}_{j}^{n}, \bar{u}_{j+1}^{n}) - \hat{f}(\bar{u}_{j-1}^{n}, \bar{u}_{j}^{n}) \right).\notag
\end{align}\]

<p>\(\mathcal{H}\) must be nondecreasing in each argument, so we compute its partial derivatives:
\(\begin{align}
  \mathcal{H}_{1} &amp;= \frac{\Delta t}{\Delta x} \hat{f}_{1}(\bar{u}_{j-1}^{n}, \bar{u}_{j}^{n})\label{eq:monotone1}\\
  \mathcal{H}_{2} &amp;= 1 - \frac{\Delta t}{\Delta x} \left( \hat{f}_{1}(\bar{u}_{j}^{n}, \bar{u}_{j+1}^{n}) - \hat{f}_{2}(\bar{u}_{j-1}^{n}, \bar{u}_{j}^{n}) \right)\label{eq:monotone2}\\
  \mathcal{H}_{3} &amp;= -\frac{\Delta t}{\Delta x} \hat{f}_{2}(\bar{u}_{j}^{n}, \bar{u}_{j+1}^{n})\label{eq:monotone3}.
\end{align}\)</p>

<p>Here, \(\hat{f}_{1}\) denotes the partial derivative of \(\hat{f}\) with respect to the first argument, and so on. If \(\hat{f}\) is increasing in the first argument and decreasing in the second argument, then \eqref{eq:monotone1} and \eqref{eq:monotone3} will be nonnegative. Furthermore, if</p>

\[\begin{align}
  \frac{\Delta t}{\Delta x} \left( \hat{f}_{1}(\bar{u}_{j}^{n}, \bar{u}_{j+1}^{n}) - \hat{f}_{2}(\bar{u}_{j-1}^{n}, \bar{u}_{j}^{n}) \right) \leqslant 1,\notag
\end{align}\]

<p>then \eqref{eq:monotone2} will also be nonnegative. This last condition is merely a restriction on our time step. By choosing \(\Delta t\) small enough, we can always satisfy this condition. The first two conditions tell us that we merely need to choose our numerical flux function \(\hat{f}\) such that it is increasing in its first argument and decreasing in its second argument.</p>

<p><strong>Proposition 1.</strong> <em>If \(\hat{f}\) satifies the following conditions:</em></p>

<ol>
  <li>
    <p><em>\(\hat{f}\) is Lipschitz continuous in all arguments.</em></p>
  </li>
  <li>
    <p><em>\(\hat{f}(u,u) = f(u)\). This is known as the consistency condition.</em></p>
  </li>
  <li>
    <p><em>\(\hat{f}\) is increasing in the first argument and decreasing in the second argument,</em></p>
  </li>
</ol>

<p><em>then the scheme \eqref{eq:finitevol2} is monotone.</em></p>

<p>We will not discuss the first two conditions here, but suffice it to say that these properties are very easy to check.</p>

<h3 id="i-numerical-flux-functions">i. Numerical Flux Functions</h3>
<p>We will briefly state some common choices of \(\hat{f}\) that satisfy the conditions of Proposition 1 and lead to monotone schemes.</p>

<p><strong>Lax-Friedrichs flux.</strong></p>

\[\begin{align}
  \hat{f}(\bar{u}_{j}, \bar{u}_{j+1}) = \frac{1}{2}\left( f(u_{j}) + f(u_{j+1}) - \alpha(u_{j+1} - u_{j}) \right),\notag\\
\end{align}\]

<p>where 
\(\alpha = \max_{u} |f'(u)|\). We can take \(\alpha = \max_{[\bar{u}_{j}, \bar{u}_{j+1}]} |f'(u)|\).</p>

<p><strong>Godunov flux.</strong></p>

\[\begin{align}
  \hat{f}(\bar{u}_{j}, \bar{u}_{j+1}) = \begin{cases}
    \min_{\bar{u}_{j} \leqslant u \leqslant \bar{u}_{j+1}} f(u), &amp;\bar{u}_{j} \leqslant \bar{u}_{j+1}\\
    \max_{\bar{u}_{j} \geqslant u \geqslant \bar{u}_{j+1}} f(u), &amp;\bar{u}_{j} &gt; \bar{u}_{j+1}.
  \end{cases}\notag
\end{align}\]

<p><strong>Engquist-Osher flux.</strong></p>

\[\begin{align}
  \hat{f}(\bar{u}_{j}, \bar{u}_{j+1}) = &amp;\int_{0}^{\bar{u}_{j}} \max\{f'(u),0\}\;du + \int_{0}^{\bar{u}_{j+1}} \min\{f'(u),0\}\;du.\notag
\end{align}\]

<p>There are two more popular choices of flux that do not lead to monotone schemes but are nevertheless still popular.</p>

<p><strong>Roe flux.</strong></p>

\[\begin{align}
  \hat{f}(\bar{u}_{j}, \bar{u}_{j+1}) = \begin{cases}
    f(\bar{u}_{j}), &amp;\frac{f(\bar{u}_{j+1}) - f(\bar{u}_{j})}{\bar{u}_{j+1} - \bar{u}_{j}} \geqslant 0\\
    f(\bar{u}_{j+1}), &amp;\frac{f(\bar{u}_{j+1}) - f(\bar{u}_{j})}{\bar{u}_{j+1} - \bar{u}_{j}} &lt; 0.
  \end{cases}\notag
\end{align}\]

<p><strong>Lax-Wendroff flux.</strong></p>

\[\begin{align}
  \hat{f}(\bar{u}_{j}, \bar{u}_{j+1}) = &amp;\frac{1}{2}(f(\bar{u}_{j}) + f(\bar{u}_{j+1})) -\notag\\
  &amp;\frac{\Delta t}{2\Delta x}f'\left( \frac{\bar{u}_{j} + \bar{u}_{j+1}}{2}\right) \left( f(\bar{u}_{j+1}) - f(\bar{u}_{j}) \right)\notag
\end{align}\]

<h2 id="ii-implementation">II. Implementation</h2>
<p>Without further ado, we will implement the first-order finite volume method using all five of the aforementioned numerical fluxes for Burgers equation with \(u(x,0) = \sin{x}\). All of the source code is publicly available on <a href="https://github.com/jdongg/numCL" rel="external nofollow noopener" target="_blank">GitHub</a> in both a MATLAB and Python implementation. For convenience, we will explain the Python implementation here. First, we initialize the parameters of the scheme.</p>

<d-code block="" language="python">
# specify domain
a = 0
b = 2*np.pi

# initial condition: u(x,0) = alpha + beta*sin(x)
alpha = 0.0
beta  = 1.0

# number of grid points in spatial discretization
N  = 80

# setup grid points
x = np.linspace(a,b,N)     
dx = (b-a)/(N-1);  

# stopping time
T = 1.5
</d-code>

<p>Next, we compute the cell averages of the initial condition, \(\bar{u}_{j}^{0}\). This is accomplished by integrating the initial condiiton over each cell \(I_{j}\):</p>
<d-code block="" language="python">
# setup array to store cell averages; due to periodicity, we omit the last cell
u = np.zeros((len(x)-1,1)); 

# returns the initial condition of the PDE
def initial_condition(z, alpha, beta):
    return alpha + beta*np.sin(z)

# compute cell averages at t=0
for i in range(0,N-1):
    u[i] = (1.0/dx)*integrate.quad(initial_condition, x[i], x[i+1], args=(alpha,beta))[0]
</d-code>

<p>Next, we must choose an appropriate time step for the scheme. Since we are using an explicit time-stepping scheme, we must choose an appropriately small time step (recall that explicit time-stepping is conditionally stable). For the purposes of example, we choose</p>

\[\frac{\Delta t}{\Delta x} \max_{u} |f'(u)| = \frac{1}{2}.\]

<p>The last step is to perform the time-stepping, whereby for each time step we must compute the numerical fluxes \(\hat{f}(\bar{u}_{j}^{n}, \bar{u}_{j+1}^{n})\) and \(\hat{f}(\bar{u}_{j-1}^{n}, \bar{u}_{j}^{n})\):</p>
<d-code block="" language="python">
t = 0.0
while t &lt; T:
    # alpha for the Lax-Friedrichs flux
    A  = np.amax(np.amax(u));

    # compute numerical fluxes fhat_{j+1/2}
    um = u
    up = np.roll(u,-1)
    fR = lf_flux(um, up, A)

    # compute numerical fluxes fhat_{j-1/2} (assuming periodic BCs)
    fL = np.roll(fR,1)

    # first order explicit time-stepping
    u -= dt/dx*(fR - fL)

    # increment time step
    t = t+dt
</d-code>

<p>Each of the numerical fluxes in Section 2.1.1 have been implemented and can be viewed on <a href="https://github.com/jdongg/numCL" rel="external nofollow noopener" target="_blank">GitHub</a>. Figure 2 shows the finite volume solutions at \(T=1.5\).</p>

<div class="container">
  <div class="row">
    <div class="col">
    </div>
    <div class="col-15">
      <figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/conslaw1/finiteVolumeBurgers-480.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/conslaw1/finiteVolumeBurgers-800.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/conslaw1/finiteVolumeBurgers-1400.webp"></source>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/conslaw1/finiteVolumeBurgers.png" class="img rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">

  </picture>

</figure>

      <div class="caption">
        <b>Figure 2:</b> Solution of Burgers equation with sine initial data using the first-order finite volume method.
      </div> 
    </div>
    <div class="col">
    </div>
  </div>
</div>

<p>The first observation we make is that there is little difference between the Roe, Godunov, and Engquist-Osher fluxes, at least for this example problem. The Godunov and Engquist-Osher fluxes lead to monotone schemes which converge to the entropy solution. The Roe flux does not lead to a monotone scheme, and in very rare cases may provide solutions with the incorrect shock speed. Nevertheless, in most cases the Roe scheme works well and is a popular choice for the numerical flux.</p>

<p>Next, the Lax-Friedrichs flux is noticeably more dissipative than any of the other results. It is known to âsmearâ discontinuities and add numerical diffusion. However, the Lax-Friedrichs flux is a very popular choice for the numerical flux since it leads to a monotone scheme and is straightforward to implement.</p>

<p>Lastly, the Lax-Wendroff flux isâ¦problematic, to say the least. Notice that the numerical solution develops spurious (nonphysical) oscillations in the vicinity of the shock at \(x=\pi\). If the Lax-Wendroff scheme converges, it converges to a weak solution, but the scheme is not monotone and does not exhibit the total variation-diminishing (TVD) property. Lax-Wendroff is actually a <em>second-order method</em> in disguise, but weâll discuss this much later and how the order of a numerical method is related to the TVD property for conservation laws.</p>

<h2 id="3-key-takeaways"><strong>3. Key Takeaways</strong></h2>
<p>If I havenât bored you to death by this point, you should have a basic understanding of weak solutions for conservation laws and the mathematical foundations for discontinuous solutions. The study of such solutions is important because they occur frequently in fluid dynamics and other related fields. You should also be able to implement a basic first-order finite volume scheme for a variety of one-dimensional conservation laws.</p>

<p>Weâve only covered first-order schemes in this post, and you might have already guessed that these methods converge too slowly to be of much use for practical problems. Next time, weâll cover higher order finite volume methods for conservation laws and touch on some of the theory regarding higher-order methods (remember how I said the Lax-Wendroff flux actually yields a second-order method? Weâll circle back to that soon). Unfortunately, thereâs no free lunch and higher order methods come with their own set of issues.</p>

<p>Below are two texts by Randy LeVeque which are helpful in fleshing out much of the details of the Theorems given in this post. Iâve found them to be immensely helpful in my Ph.D. studies.</p>

<h2 id="4-references"><strong>4. References</strong></h2>
<p>[1] LeVeque, Randall J. <a href="http://staff.washington.edu/rjl/book2/sample.pdf" rel="external nofollow noopener" target="_blank">Finite volume methods for hyperbolic problems</a>. Vol. 31. Cambridge university press, 2002.</p>

<p>[2] LeVeque, Randall J. <a href="https://pdfs.semanticscholar.org/1470/c6f43c769572c4cfc94ffc9c5710484ff1e5.pdf" rel="external nofollow noopener" target="_blank">Numerical methods for conservation laws</a>. Vol. 132. Basel: BirkhÃ¤user, 1992.</p>

<h2 id="5-codes"><strong>5. Codes</strong></h2>
<p><a href="https://github.com/jdongg/numCL" rel="external nofollow noopener" target="_blank">NumCL repository on GitHub</a></p>

      </d-article>

      <d-appendix>
        <d-footnote-list></d-footnote-list>
        <d-citation-list></d-citation-list>
      </d-appendix>

      <d-bibliography src="/assets/bibliography/"></d-bibliography>
</div>

    <!-- Footer -->    
    <footer class="fixed-bottom">
      <div class="container mt-0">
        Â© Copyright 2023 Justin  Dong. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>.

      </div>
    </footer>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    
    

<!-- Scrolling Progress Bar -->
<script type="text/javascript">
  /*
   * This JavaScript code has been adapted from the article 
   * https://css-tricks.com/reading-position-indicator/ authored by Pankaj Parashar, 
   * published on the website https://css-tricks.com on the 7th of May, 2014.
   * Couple of changes were made to the original code to make it compatible 
   * with the `al-foio` theme.
   */
  const progressBar = $("#progress");
  /*
   * We set up the bar after all elements are done loading.
   * In some cases, if the images in the page are larger than the intended
   * size they'll have on the page, they'll be resized via CSS to accomodate
   * the desired size. This mistake, however, breaks the computations as the
   * scroll size is computed as soon as the elements finish loading.
   * To account for this, a minimal delay was introduced before computing the
   * values.
   */
  window.onload = function () {
    setTimeout(progressBarSetup, 50);
  };
  /*
   * We set up the bar according to the browser.
   * If the browser supports the progress element we use that.
   * Otherwise, we resize the bar thru CSS styling
   */
  function progressBarSetup() {
    if ("max" in document.createElement("progress")) {
      initializeProgressElement();
      $(document).on("scroll", function() {
        progressBar.attr({ value: getCurrentScrollPosition() });
      });
      $(window).on("resize", initializeProgressElement);
    } else {
      resizeProgressBar();
      $(document).on("scroll", resizeProgressBar);
      $(window).on("resize", resizeProgressBar);
    }
  }
  /*
   * The vertical scroll position is the same as the number of pixels that
   * are hidden from view above the scrollable area. Thus, a value > 0 is
   * how much the user has scrolled from the top
   */
  function getCurrentScrollPosition() {
    return $(window).scrollTop();
  }

  function initializeProgressElement() {
    let navbarHeight = $("#navbar").outerHeight(true);
    $("body").css({ "padding-top": navbarHeight });
    $("progress-container").css({ "padding-top": navbarHeight });
    progressBar.css({ top: navbarHeight });
    progressBar.attr({
      max: getDistanceToScroll(),
      value: getCurrentScrollPosition(),
    });
  }
  /*
   * The offset between the html document height and the browser viewport
   * height will be greater than zero if vertical scroll is possible.
   * This is the distance the user can scroll
   */
  function getDistanceToScroll() {
    return $(document).height() - $(window).height();
  }

  function resizeProgressBar() {
    progressBar.css({ width: getWidthPercentage() + "%" });
  }
  // The scroll ratio equals the percentage to resize the bar
  function getWidthPercentage() {
    return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
  }
</script>

  
</body>
</html>
